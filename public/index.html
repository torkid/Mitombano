<!DOCTYPE html>
<html lang="sw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PenziShata | Video za Siri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
        }

        /* Video Card - TikTok/Reels Style */
        .video-card {
            position: relative;
            aspect-ratio: 9/16;
            background: #111;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
        }

        .video-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-card:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        /* Gradient overlay for text */
        .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 60px 12px 12px;
        }

        /* Play button */
        .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .video-card:hover .play-btn {
            background: rgba(220, 38, 38, 0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Badge */
        .badge {
            display: inline-block;
            background: #dc2626;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        /* Modal slide up animation */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .modal-content {
            animation: slideUp 0.3s ease-out;
        }

        /* Hide scrollbar */
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="bg-black min-h-screen">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-black/90 backdrop-blur-lg border-b border-white/10">
        <div class="flex items-center justify-between px-4 py-3">
            <h1 class="text-xl font-black tracking-tight">
                PENZI<span class="text-red-500">SHATA</span>
            </h1>
            <button class="open-modal-trigger bg-red-600 text-white text-xs font-bold px-3 py-1.5 rounded-full">
                VIP ACCESS
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="px-2 py-4 pb-24">

        <!-- Video Grid -->
        <div id="video-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
            <!-- Videos will be injected here -->
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-black border-t border-white/10 z-40">
        <div class="flex justify-around py-2">
            <a href="#" class="flex flex-col items-center text-white/60 text-xs p-2">
                <i class="fas fa-home text-lg mb-1 text-red-500"></i>
                <span class="text-red-500">Home</span>
            </a>
            <a href="#" class="flex flex-col items-center text-white/60 text-xs p-2">
                <i class="fas fa-fire text-lg mb-1"></i>
                <span>Trending</span>
            </a>
            <button
                class="open-modal-trigger bg-red-600 text-white rounded-lg px-6 py-2 font-bold text-sm -mt-4 shadow-lg shadow-red-500/30">
                <i class="fas fa-play mr-1"></i> UNLOCK
            </button>
            <a href="#" class="flex flex-col items-center text-white/60 text-xs p-2">
                <i class="fas fa-crown text-lg mb-1"></i>
                <span>VIP</span>
            </a>
            <a href="#" class="flex flex-col items-center text-white/60 text-xs p-2">
                <i class="fas fa-user text-lg mb-1"></i>
                <span>Profile</span>
            </a>
        </div>
    </nav>

    <!-- Payment Modal -->
    <div id="payment-modal" class="fixed inset-0 bg-black/95 z-[60] hidden items-end justify-center">
        <div class="modal-content bg-zinc-900 w-full max-w-md rounded-t-3xl overflow-hidden max-h-[85vh]">

            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <h2 class="text-lg font-bold">Fungua Video Zote</h2>
                <button id="close-modal" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center">
                    <i class="fas fa-times text-white/60"></i>
                </button>
            </div>

            <div class="p-5">
                <!-- Form View -->
                <div id="form-view">
                    <!-- Price Banner -->
                    <div class="bg-gradient-to-r from-red-600 to-red-500 rounded-2xl p-5 mb-5 text-center">
                        <p class="text-white/80 text-sm mb-1">Malipo ya mara moja</p>
                        <p class="text-4xl font-black">TSH 1,000</p>
                        <p class="text-white/60 text-xs mt-2">Pata access ya video zote bila kikomo</p>
                    </div>

                    <!-- Features -->
                    <div class="space-y-3 mb-5">
                        <div class="flex items-center gap-3 text-sm">
                            <i class="fas fa-check-circle text-green-500"></i>
                            <span class="text-white/80">Video zote zimefunguliwa</span>
                        </div>
                        <div class="flex items-center gap-3 text-sm">
                            <i class="fas fa-check-circle text-green-500"></i>
                            <span class="text-white/80">Download bila kikomo</span>
                        </div>
                        <div class="flex items-center gap-3 text-sm">
                            <i class="fas fa-shield-alt text-green-500"></i>
                            <span class="text-white/80">Faragha yako salama 100%</span>
                        </div>
                    </div>

                    <!-- Payment Form -->
                    <form id="payment-form" class="space-y-4">
                        <div>
                            <label class="block text-white/60 text-xs mb-2 uppercase tracking-wider">Namba ya
                                Simu</label>
                            <input type="tel" id="phone" name="phone"
                                class="w-full bg-black border border-white/20 rounded-xl p-4 text-xl font-bold text-white text-center tracking-widest focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500"
                                placeholder="07XXXXXXXX" required pattern="0[6-7][0-9]{8}" inputmode="numeric">
                        </div>

                        <button type="submit"
                            class="w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-bold text-lg py-4 rounded-xl transition-all">
                            <i class="fas fa-unlock mr-2"></i> LIPA SASA
                        </button>
                    </form>

                    <!-- Payment Logos -->
                    <div class="mt-5 flex justify-center">
                        <img src="/zenopay-logo.png" class="h-8 object-contain opacity-70" alt="Payment Methods">
                    </div>
                </div>

                <!-- Loading View -->
                <div id="waiting-view" class="hidden text-center py-8">
                    <div
                        class="w-16 h-16 border-4 border-zinc-700 border-t-red-500 rounded-full animate-spin mx-auto mb-5">
                    </div>
                    <h3 class="text-xl font-bold mb-2">Inasubiri...</h3>
                    <p class="text-white/60 text-sm mb-4">Ombi limetumwa kwenye simu yako</p>
                    <div
                        class="bg-yellow-500/20 text-yellow-400 px-4 py-2 rounded-lg text-sm font-medium inline-block animate-pulse">
                        <i class="fas fa-mobile-alt mr-2"></i> Weka PIN kwenye simu
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Video Data
        const videoLinks = [
            "https://www.empressleak.xyz/media/videos/tmb/7072/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6995/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6892/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6777/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6726/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6673/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7167/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7047/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7099/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7097/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7071/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/7042/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6991/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6992/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6920/video.webm",
            "https://www.empressleak.xyz/media/videos/tmb/6904/video.webm"
        ];

        const videoTitles = [
            "Mke wa Mtu Gesti ðŸ”¥",
            "Mwanafunzi Chuo",
            "Mtoto wa Mchungaji",
            "Bibi Harusi",
            "Housegirl Nguo Fupi",
            "Shemeji Jikoni",
            "Daktari wa Kichaa",
            "Housegirl na Bosi",
            "Wema Sepetu",
            "Biology Class",
            "Daladala Scene",
            "Toto la Sinza",
            "Askari na Mtuhumiwa",
            "Binti Kiziwi",
            "Mke wa Bosi",
            "Mganga na Mteja"
        ];

        // DOM Elements
        const videoGrid = document.getElementById('video-grid');
        const paymentModal = document.getElementById('payment-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const formView = document.getElementById('form-view');
        const waitingView = document.getElementById('waiting-view');
        const paymentForm = document.getElementById('payment-form');

        // Create Video Card
        function createVideoCard(src, title, index) {
            const badges = ['NEW', 'HOT', 'VIRAL', 'LEAKED', '18+'];
            const badge = badges[index % badges.length];
            const views = Math.floor(Math.random() * 50 + 10) + 'K';

            const card = document.createElement('div');
            card.className = 'video-card gossip-card open-modal-trigger';
            card.innerHTML = `
                <video loop muted playsinline preload="none" data-src="${src}"></video>
                <div class="play-overlay absolute inset-0 flex items-center justify-center">
                    <div class="play-btn">
                        <i class="fas fa-play text-white text-xl ml-1"></i>
                    </div>
                </div>
                <div class="video-overlay">
                    <span class="badge mb-2">${badge}</span>
                    <h3 class="font-bold text-sm leading-tight">${title}</h3>
                    <p class="text-white/50 text-xs mt-1"><i class="fas fa-eye mr-1"></i>${views} views</p>
                </div>
            `;

            // Hover play
            const video = card.querySelector('video');
            card.addEventListener('mouseenter', () => {
                if (!video.src && video.dataset.src) {
                    video.src = video.dataset.src;
                    video.load();
                }
                video.play().catch(() => { });
            });
            card.addEventListener('mouseleave', () => {
                video.pause();
                video.currentTime = 0;
            });

            return card;
        }

        // Populate Grid
        videoLinks.forEach((link, i) => {
            videoGrid.appendChild(createVideoCard(link, videoTitles[i] || 'Video ' + (i + 1), i));
        });

        // Modal Functions
        const openModal = () => {
            paymentModal.classList.remove('hidden');
            paymentModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        };

        const closeModal = () => {
            paymentModal.classList.add('hidden');
            paymentModal.classList.remove('flex');
            document.body.style.overflow = '';
            setTimeout(() => {
                formView.style.display = 'block';
                waitingView.style.display = 'none';
            }, 200);
        };

        // Attach Modal Triggers with 3-second video preview
        function attachModalTriggers() {
            document.querySelectorAll('.open-modal-trigger').forEach(trigger => {
                if (trigger.dataset.modalAttached) return;
                trigger.dataset.modalAttached = 'true';

                trigger.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Video card - play 3 seconds first
                    if (trigger.classList.contains('gossip-card')) {
                        const video = trigger.querySelector('video');
                        const playOverlay = trigger.querySelector('.play-overlay');

                        if (video) {
                            if (!video.src && video.dataset.src) {
                                video.src = video.dataset.src;
                                video.load();
                            }

                            if (playOverlay) playOverlay.style.display = 'none';
                            video.muted = false;
                            video.play().catch(() => { });

                            setTimeout(() => {
                                video.pause();
                                video.muted = true;
                                if (playOverlay) playOverlay.style.display = 'flex';
                                openModal();
                            }, 3000);

                            return;
                        }
                    }

                    openModal();
                });
            });
        }

        attachModalTriggers();
        setTimeout(attachModalTriggers, 500);

        closeModalBtn.addEventListener('click', closeModal);
        paymentModal.addEventListener('click', (e) => {
            if (e.target === paymentModal) closeModal();
        });

        // Payment Form
        paymentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            formView.style.display = 'none';
            waitingView.style.display = 'block';

            setTimeout(async () => {
                const phone = document.getElementById('phone').value;
                try {
                    const response = await fetch('/pay', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ phone })
                    });
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.message_body || 'Error');

                    const orderId = result.reference;
                    const poll = setInterval(async () => {
                        try {
                            const sRes = await fetch(`/check-status?order_id=${orderId}`);
                            const sData = await sRes.json();
                            if (sData.status === 'COMPLETED') {
                                clearInterval(poll);
                                window.location.href = 'success.html';
                            } else if (sData.status === 'FAILED') {
                                clearInterval(poll);
                                alert("Malipo yameshindikana.");
                                closeModal();
                            }
                        } catch (err) { }
                    }, 3000);
                } catch (err) {
                    alert("Tatizo: " + err.message);
                    closeModal();
                }
            }, 1000);
        });

        // Lazy Load Videos
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const video = entry.target;
                    if (video.dataset.src && !video.src) {
                        video.src = video.dataset.src;
                        video.load();
                    }
                    observer.unobserve(video);
                }
            });
        }, { rootMargin: '100px' });

        document.querySelectorAll('video[data-src]').forEach(v => observer.observe(v));
    </script>
</body>

</html>